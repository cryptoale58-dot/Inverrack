
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InverTrack Pro | Terminal</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root {
            --bg-black: #030303;
            --bg-sidebar: #0a0a0a;
            --bg-card: rgba(18, 18, 18, 0.7);
            --accent-green: #00ffa3;
            --accent-red: #ff4d4d;
            --accent-yellow: #ffb347;
            --accent-blue: #47a1ff;
            --text-main: #ffffff;
            --text-dim: #888888;
            --border: rgba(255, 255, 255, 0.08);
            --input-bg: #141414;
        }

        /* --- ANIMACIONES DE PRECIO EN VIVO --- */
        .price-up {
            color: var(--accent-green) !important;
            text-shadow: 0 0 10px rgba(0, 255, 163, 0.5);
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }

        .price-down {
            color: var(--accent-red) !important;
            text-shadow: 0 0 10px rgba(255, 77, 77, 0.5);
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }

        .ticker-item span {
            transition: color 1s ease; /* Suaviza el regreso al color original */
            color: #ccc;
        }

        * { box-sizing: border-box; outline: none; -webkit-font-smoothing: antialiased; }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-black);
            color: var(--text-main);
            margin: 0; display: flex; height: 100vh; overflow: hidden;
        }

        /* --- MARKET TICKER (ARREGLADO) --- */
        #market-ticker {
            position: fixed; top: 0; left: 300px; right: 0; height: 55px;
            background: rgba(5, 5, 5, 0.9); backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border); z-index: 100; overflow: hidden;
            display: flex; align-items: center;
        }
        
                /* --- TICKER PROFESIONAL MEJORADO --- */
        .ticker-wrap {
            width: 100%;
            height: 40px; /* Altura fija */
            background: rgba(10, 10, 10, 0.8); /* Fondo oscuro */
            backdrop-filter: blur(5px); /* Efecto vidrio */
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            white-space: nowrap;
            position: relative;
            z-index: 10;
            display: flex;
            align-items: center;
        }

        .ticker-move {
            display: inline-block;
            white-space: nowrap;
            /* La animaciÃ³n se ajustarÃ¡ con JS para ser perfecta, 
            pero ponemos una base suave */
            animation: ticker-scroll 80s linear infinite;
        }

        /* Pausar animaciÃ³n al poner el mouse encima */
        .ticker-wrap:hover .ticker-move {
            animation-play-state: paused;
        }

        .ticker-item {
            display: inline-flex;
            align-items: center;
            padding: 0 2rem; /* Espacio entre elementos */
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: #e2e8f0;
            border-right: 1px solid rgba(255,255,255,0.05);
        }

        .ticker-logo {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border-radius: 50%;
        }

        .ticker-price {
            font-weight: 700;
            margin-left: 8px;
            transition: color 0.3s ease;
        }
        /* Emojis de Oro y Plata alineados al tamaÃ±o de los logos */
                .ticker-item span[style*="font-size: 14px"] {
                    font-size: 24px !important; /* Emojis mÃ¡s grandes */
                    margin-right: 12px;
                    display: inline-block;
                    width: 32px;                /* Mismo ancho que el logo para alinear todo */
                    text-align: center;
                }

        /* Colores para las variaciones */
        .trend-up { color: #00ffa3; }
        .trend-down { color: #ff4d4d; }

        @keyframes ticker-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); } /* Movemos solo el 50% porque duplicamos el contenido */
        }

        

        /* --- SIDEBAR --- */
        #sidebar {
            width: 300px; background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            padding: 2.5rem 1.5rem; display: flex; flex-direction: column; z-index: 10;
        }
        .logo-box { padding: 0 0.5rem; margin-bottom: 2.5rem; font-size: 0.85rem; font-weight: 800; letter-spacing: 1px; color: white; display: flex; align-items: center; gap: 10px; }
        .logo-box i { color: var(--accent-green); }

        .nav-item {
            padding: 10px 12px; border-radius: 10px; cursor: pointer;
            display: flex; align-items: center; gap: 12px; font-size: 0.8rem;
            color: var(--text-dim); transition: 0.2s; margin-bottom: 4px;
        }
        .nav-item:hover { background: rgba(255,255,255,0.04); color: white; }
        .nav-item.active { background: rgba(255, 255, 255, 0.06); color: white; font-weight: 600; }

        .form-section { 
            margin-top: auto; padding: 1.5rem 0.5rem 0;
            border-top: 1px solid var(--border); display: flex; flex-direction: column; gap: 12px;
        }
        .form-label {
            font-size: 0.6rem; font-weight: 700; color: var(--text-dim);
            text-transform: uppercase; letter-spacing: 1px;
        }
        input, select {
            background: var(--input-bg); border: 1px solid var(--border);
            padding: 12px; border-radius: 10px; color: white; font-size: 0.8rem;
            transition: 0.2s; width: 100%;
        }
        input:focus { border-color: #444; background: #1a1a1a; }

        .btn-deploy {
            background: white; color: black; border: none; padding: 12px;
            border-radius: 10px; font-weight: 700; font-size: 0.8rem;
            cursor: pointer; transition: 0.2s; margin-top: 5px;
        }
        .btn-deploy:hover { background: #e0e0e0; transform: translateY(-1px); }

       .filter-group { 
            display: flex !important; flex-direction: row !important; align-items: center; 
            gap: 4px; margin-bottom: 15px; background: rgba(255,255,255,0.03); 
            padding: 4px; border-radius: 12px; width: fit-content; flex-wrap: nowrap;
        }
        .filter-btn { 
            background: transparent; border: none; color: var(--text-dim); 
            padding: 6px 10px; border-radius: 8px; cursor: pointer; font-size: 0.65rem; 
            font-weight: 700; transition: 0.2s;
        }
        .filter-btn.active { background: rgba(255,255,255,0.08); color: white; }

        .backup-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 15px; }
        .btn-backup { background: rgba(255,255,255,0.05); color: #888; border: 1px solid var(--border); padding: 8px; border-radius: 8px; font-size: 0.65rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; font-weight: 600; }
        .btn-backup:hover { background: rgba(255,255,255,0.1); color: white; }

        #main { flex-grow: 1; padding: 90px 4rem 4rem; overflow-y: auto; background: radial-gradient(circle at top right, #0f0f0f, #030303); }
        .container { max-width: 1100px; margin: 0 auto; }
        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 2.5rem 0; }
        .stat-card { background: var(--bg-card); padding: 1.8rem; border-radius: 20px; border: 1px solid var(--border); }
        .stat-val { font-size: 2rem; font-weight: 700; margin-top: 8px; letter-spacing: -1px; }
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 24px; padding: 2rem; position: relative;}
        
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px 20px; color: var(--text-dim); font-size: 0.6rem; text-transform: uppercase; }
        td { padding: 16px 20px; border-bottom: 1px solid var(--border); font-size: 0.85rem; }
        .tag { font-size: 0.55rem; padding: 4px 8px; border-radius: 6px; font-weight: 700; text-transform: uppercase; background: rgba(255,255,255,0.05); color: #ccc; }
        .hidden-val { filter: blur(8px); }
        .btn-icon { background: transparent; border: 1px solid var(--border); color: white; padding: 8px 16px; border-radius: 10px; cursor: pointer; font-size: 0.7rem; font-weight: 600; display: flex; align-items: center; gap: 8px; }

        .future-item {
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(255,255,255,0.03); padding: 15px 20px;
            border-radius: 15px; margin-bottom: 10px; border: 1px solid var(--border);
        }
        .future-main-info { display: flex; align-items: center; gap: 15px; }
        .priority-dot { width: 10px; height: 10px; border-radius: 50%; }
        .priority-label { font-size: 0.6rem; font-weight: 800; text-transform: uppercase; padding: 2px 6px; border-radius: 4px; }
        .future-actions { display: flex; gap: 8px; }
        .btn-move { background: none; border: none; color: var(--text-dim); cursor: pointer; padding: 5px; border-radius: 5px; transition: 0.2s; }
        .btn-move:hover { color: white; background: rgba(255,255,255,0.1); }
        
        .btn-link-external { color: var(--accent-green); transition: 0.2s; display: flex; align-items: center; cursor: pointer; }
        .btn-link-external:hover { transform: scale(1.1); filter: brightness(1.2); }
    </style>
</head>
<body>

<aside id="sidebar">
    <div class="logo-box"><i data-lucide="shield-check"></i> INVERTRACK PRO</div>
    <div class="nav-item active" onclick="showGlobal()" id="btnGlobal">
        <i data-lucide="layout-grid" size="18"></i> <span>Dashboard</span>
    </div>
    <div class="nav-item" onclick="showFutureProjects()" id="btnFuture">
        <i data-lucide="rocket" size="18"></i> <span>Futuros Proyectos</span>
    </div>
    <div class="nav-item" onclick="showCompound()" id="btnCompound">
        <i data-lucide="line-chart" size="18"></i> <span>InterÃ©s Compuesto</span>
    </div>

    <div style="flex-grow: 1; overflow-y: auto; margin-top: 1.5rem;">
        <div class="form-label" style="padding-left: 12px; margin-bottom: 10px;">Assets</div>
        <div id="listActive"></div>
    </div>

    <div class="form-section">
        <span class="form-label">Data Management</span>
        <div class="backup-controls">
            <button class="btn-backup" onclick="exportData()"><i data-lucide="download" size="14"></i> Export</button>
            <button class="btn-backup" onclick="document.getElementById('fileInput').click()"><i data-lucide="upload" size="14"></i> Import</button>
            <input type="file" id="fileInput" style="display:none" accept=".json" onchange="importData(event)">
        </div>
        <span class="form-label" style="margin-top:10px">Add Asset</span>
        <input type="text" id="pName" placeholder="Asset name...">
        <select id="pCat">
            <option value="Fondo de InversiÃ³n">Fondo de InversiÃ³n</option>
            <option value="Plata">Plata</option>
            <option value="Pokemon">Pokemon</option>
            <option value="One Piece">One Piece</option>
            <option value="Nfts">Nfts</option>
            <option value="Gunbattleparty">Gunbattleparty</option>
        </select>
        <input type="text" id="pLink" placeholder="Link URL (optional)...">
        <button onclick="addProject()" class="btn-deploy">Add to Portfolio</button>
    </div>
    <div id="market-ticker">
        <div class="ticker-move">
        <div class="ticker-item"><img src="https://s2.coinmarketcap.com/static/img/coins/64x64/1.png" class="ticker-logo"> BTC <span class="tick-btc">$---</span></div>
        <div class="ticker-item"><img src="https://s2.coinmarketcap.com/static/img/coins/64x64/1027.png" class="ticker-logo"> ETH <span class="tick-eth">$---</span></div>
        <div class="ticker-item"><img src="https://s2.coinmarketcap.com/static/img/coins/64x64/5426.png" class="ticker-logo"> SOL <span class="tick-sol">$---</span></div>
        <div class="ticker-item"><img src="https://s2.coinmarketcap.com/static/img/coins/64x64/24478.png" class="ticker-logo"> PEPE <span class="tick-pepe">$---</span></div>
        <div class="ticker-item"><img src="https://s2.coinmarketcap.com/static/img/coins/64x64/10804.png" class="ticker-logo"> FLOKI <span class="tick-floki">$---</span></div>
        <div class="ticker-item"><span style="font-size: 14px;">ðŸŒ•</span> ORO <span class="tick-gold">$---</span></div>
        <div class="ticker-item"><span style="font-size: 14px;">âšª</span> PLATA <span class="tick-silver">$---</span></div>

        <div class="ticker-item"><img src="https://s2.coinmarketcap.com/static/img/coins/64x64/1.png" class="ticker-logo"> BTC <span class="tick-btc">$---</span></div>
        <div class="ticker-item"><img src="https://s2.coinmarketcap.com/static/img/coins/64x64/1027.png" class="ticker-logo"> ETH <span class="tick-eth">$---</span></div>
        <div class="ticker-item"><img src="https://s2.coinmarketcap.com/static/img/coins/64x64/5426.png" class="ticker-logo"> SOL <span class="tick-sol">$---</span></div>
        <div class="ticker-item"><img src="https://s2.coinmarketcap.com/static/img/coins/64x64/24478.png" class="ticker-logo"> PEPE <span class="tick-pepe">$---</span></div>
        <div class="ticker-item"><img src="https://s2.coinmarketcap.com/static/img/coins/64x64/10804.png" class="ticker-logo"> FLOKI <span class="tick-floki">$---</span></div>
        <div class="ticker-item"><span style="font-size: 14px;">ðŸŒ•</span> ORO <span class="tick-gold">$---</span></div>
        <div class="ticker-item"><span style="font-size: 14px;">âšª</span> PLATA <span class="tick-silver">$---</span></div>
            </div>
        </div>
    </div>
</aside>

<main id="main">
    <div class="container">
        <div id="global-view">
            <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom: 2rem;">
                <h1 style="font-size: 2.2rem; margin:0; font-weight: 800; letter-spacing: -1px;">Portfolio</h1>
                <div style="display:flex; gap:12px">
                    <button class="btn-icon" onclick="exportToPDF()"><i data-lucide="file-text" size="14"></i> Export PDF</button>
                    <button class="btn-icon" onclick="togglePrivacy()"><i data-lucide="eye-off" size="14"></i> Privacy</button>
                </div>
            </div>
            
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="form-label">Total Balance</div>
                    <div class="stat-val val-reveal" id="g-total">$0</div>
                </div>
                <div class="stat-card">
                    <div class="form-label">Performance</div>
                    <div class="stat-val" id="g-roi" style="color:var(--accent-green)">0%</div>
                </div>
                <div class="stat-card">
                    <div class="form-label">Net Profit</div>
                    <div class="stat-val val-reveal" id="g-profit">$0</div>
                </div>
            </div>

            
            
           <div class="filter-group" style="margin-top: 20px;"> 
                <button class="filter-btn" data-range="ALL" onclick="setRange('ALL', this)">ALL</button>
                <button class="filter-btn" data-range="12" onclick="setRange(12, this)">1Y</button>
                <button class="filter-btn" data-range="6" onclick="setRange(6, this)">6M</button>
                <button class="filter-btn" data-range="3" onclick="setRange(3, this)">3M</button>
                <button class="filter-btn" data-range="1" onclick="setRange(1, this)">1M</button>
                <button class="filter-btn" data-range="1W" onclick="setRange('1W', this)">1W</button>
                <button class="filter-btn" data-range="1D" onclick="setRange('1D', this)">1D</button>
                <button onclick="toggleSMA()" class="filter-btn" id="btnSMA_global" style="color: #555; border-left: 1px solid var(--border); margin-left: 5px;">
                    <i data-lucide="trending-up" size="14"></i>
                </button>
        </div>

            <div style="display: grid; grid-template-columns: 1.8fr 1fr; gap: 20px; margin-bottom: 2rem;">
                <div class="card"><canvas id="globalChart"></canvas></div>
                <div class="card" style="display:flex; align-items:center; justify-content:center;">
                    <div style="width: 100%; height: 100%; min-height: 250px;">
                        <canvas id="donutChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="card" style="padding: 0; overflow: hidden;">
                <table>
                    <thead>
                        <tr><th>Class</th><th>Asset</th><th>Value</th><th>Profit</th><th>Perf.</th><th>Weight</th></tr>
                    </thead>
                    <tbody id="globalBody"></tbody>
                </table>
            </div>
        </div>

        <div id="detail-view" style="display:none">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem">
                <div style="display:flex; align-items:center; gap:15px">
                    <h1 id="pTitle" style="font-size: 2rem; margin:0; font-weight:800;"></h1>
                    <div id="pLinkIcon"></div>
                </div>
                <button class="btn-icon" style="color:var(--accent-red)" onclick="deleteProject()">Delete</button>
            </div>
            
            <div class="stat-grid" style="margin-bottom: 2rem;">
                <div class="stat-card">
                    <div class="form-label">Asset Value</div>
                    <div class="stat-val val-reveal" id="p-total">$0</div>
                </div>
                <div class="stat-card">
                    <div class="form-label">Performance</div>
                    <div class="stat-val" id="p-roi">0%</div>
                </div>
                <div class="stat-card">
                    <div class="form-label">Net Profit</div>
                    <div class="stat-val val-reveal" id="p-profit">$0</div>
                </div>
            </div>

            <div class="filter-group">
                <button class="filter-btn" data-range="ALL" onclick="setRange('ALL', this)">ALL</button>
                <button class="filter-btn" data-range="12" onclick="setRange(12, this)">1Y</button>
                <button class="filter-btn" data-range="6" onclick="setRange(6, this)">6M</button>
                <button class="filter-btn" data-range="3" onclick="setRange(3, this)">3M</button>
                <button class="filter-btn" data-range="1" onclick="setRange(1, this)">1M</button>
                <button class="filter-btn" data-range="1W" onclick="setRange('1W', this)">1W</button>
                <button class="filter-btn active" data-range="1D" onclick="setRange('1D', this)">1D</button>
                
                <button onclick="toggleSMA()" class="filter-btn" id="btnSMA_detail" style="color: var(--accent-green); border-left: 1px solid var(--border); margin-left: 5px;">
                    <i data-lucide="trending-up" size="14"></i>
                </button>
            </div>

            <div style="background: var(--bg-card); padding: 25px; border-radius: 20px; border: 1px solid var(--border); display: flex; gap: 20px; align-items: flex-end; margin-bottom: 2rem;">
                <div style="flex: 1;">
                    <span class="form-label">Fecha Exacta</span>
                    <input type="date" id="pMonth" style="margin-top:8px">
                </div>
                <div style="flex: 1;">
                    <span class="form-label">Valor (USD)</span>
                    <input type="number" id="pPrice" placeholder="0.00" style="margin-top:8px">
                </div>
                <button onclick="addPrice()" class="btn-deploy" style="margin:0; padding: 12px 30px;">Actualizar</button>
            </div>
            <div class="card" style="height:400px"><canvas id="detailChart"></canvas></div>
        </div>

        <div id="future-view" style="display:none">
            <h1 style="font-size: 2.2rem; margin:0 0 2rem 0; font-weight: 800; letter-spacing: -1px;">Futuros Proyectos</h1>
            <div class="card" style="margin-bottom: 2rem;">
                <div style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 15px; align-items: flex-end;">
                    <div>
                        <span class="form-label">Nombre del proyecto</span>
                        <input type="text" id="futureInput" placeholder="..." style="margin-top:8px">
                    </div>
                    <div>
                        <span class="form-label">Importancia</span>
                        <select id="futurePriority" style="margin-top:8px">
                            <option value="Alta">Alta</option>
                            <option value="Media">Media</option>
                            <option value="Baja">Baja</option>
                        </select>
                    </div>
                    <button class="btn-deploy" style="margin:0; padding: 12px 30px;" onclick="addFuture()">AÃ±adir</button>
                </div>
            </div>
            <div id="futureList"></div>
        </div>

        <div id="compound-view" style="display:none">
            <h1 style="font-size: 2.2rem; margin:0 0 1rem 0; font-weight: 800; letter-spacing: -1px;">Calculadora Proyectiva</h1>
            
            <div style="margin-bottom: 2rem; border-left: 3px solid var(--accent-green); padding: 15px 25px; background: rgba(0, 255, 163, 0.04); border-radius: 0 12px 12px 0; max-width: 800px;">
                <p style="margin:0; font-style: italic; color: var(--text-dim); line-height: 1.6; font-size: 1.05rem;">
                    "El interÃ©s compuesto es la octava maravilla del mundo. <br>
                    Aquel que lo comprende, lo <span style="color: var(--accent-green); font-weight: 700;">gana</span>; aquel que no, lo <span style="color: var(--accent-red); font-weight: 700;">paga</span>."
                </p>
                <div style="font-size: 0.85rem; color: var(--accent-green); opacity: 0.8; margin-top: 8px; font-weight: 600; letter-spacing: 1px;">â€” ALBERT EINSTEIN</div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 2rem;">
                <div class="card">
                    <span class="form-label">Capital Inicial (USD)</span>
                    <input type="number" id="cInitial" placeholder="1000" style="margin: 8px 0 15px;">
                    <span class="form-label">Aporte Mensual (USD)</span>
                    <input type="number" id="cMonthly" placeholder="100" style="margin: 8px 0 15px;">
                    <span class="form-label">Tasa Anual (%)</span>
                    <input type="number" id="cRate" placeholder="10" style="margin: 8px 0 15px;">
                    <span class="form-label">AÃ±os</span>
                    <input type="number" id="cYears" placeholder="5" style="margin: 8px 0 20px;">
                    <button onclick="calculateCompound()" class="btn-deploy" style="width:100%">Calcular ProyecciÃ³n</button>
                </div>
                
                <div class="stat-grid" style="grid-template-columns: 1fr; margin: 0; gap: 15px;">
                    <div class="stat-card">
                        <div class="form-label">Monto Final Estimado</div>
                        <div class="stat-val" id="c-final" style="color:var(--accent-green)">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="form-label">Total Invertido</div>
                        <div class="stat-val" id="c-invested">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="form-label">Intereses Ganados</div>
                        <div class="stat-val" id="c-interest" style="color:var(--accent-blue)">$0</div>
                    </div>
                </div>
            </div>
            
            <div class="card" style="height:350px">
                <canvas id="compoundChart"></canvas>
            </div>
        </div>

    </div>
</main>

<script>
    let projects = JSON.parse(localStorage.getItem('invertrack_v15'));

    if (!projects || Object.keys(projects).length === 0) {
        projects = {
            "Cvm Capital": { "cat": "Fondo de InversiÃ³n", "link": "", "data": [{ "month": "2025-12-01", "price": 1200 }] },
            "Plata": { "cat": "Plata", "link": "", "data": [{ "month": "2025-12-01", "price": 201 }] },
            "Kanstars": { "cat": "Nfts", "link": "", "data": [{ "month": "2025-12-01", "price": 20 }] },
            "Pokemon": { "cat": "Pokemon", "link": "", "data": [{ "month": "2025-12-01", "price": 168 }] },
            "One Piece": { "cat": "One Piece", "link": "", "data": [{ "month": "2025-12-01", "price": 100 }] },
            "Primos": { "cat": "Nfts", "link": "", "data": [{ "month": "2025-12-01", "price": 8 }] }
        };
    }

    let futureProjects = JSON.parse(localStorage.getItem('invertrack_futures_v2')) || [];
    let current = null, isPrivate = false, currentRange = 'ALL';
    let gChart = null, dChart = null, detChart = null, compChart = null;
    let showSMA = false; 

    const colors = { 
        "Fondo de InversiÃ³n": '#67e8f9',
        "Plata": '#e2e8f0',
        "Pokemon": '#ffb347',
        "One Piece": '#ff4d4d',
        "Nfts": '#a78bfa',
        "Gunbattleparty": '#00ffa3',
        "Gunbattle party": '#00ffa3' 
    };
    const priorityColors = {
        "Alta": "var(--accent-red)",
        "Media": "var(--accent-yellow)",
        "Baja": "var(--accent-blue)"
    };

    // --- LOGICA DE MERCADO (TICKER) CON ANIMACIÃ“N VERDE/ROJA ---
    async function fetchMarketPrices() {
        const symbols = ["BTCUSDT","ETHUSDT","SOLUSDT","PEPEUSDT","FLOKIUSDT","PAXGUSDT"];
        
        try {
            // Usamos una URL directa sin construir strings complejos
            const response = await fetch(`https://api.binance.com/api/v3/ticker/price`);
            const allPrices = await response.json();

            // Filtramos solo lo que necesitamos de forma segura
            const prices = {};
            allPrices.forEach(item => {
                if (symbols.includes(item.symbol)) {
                    prices[item.symbol] = parseFloat(item.price);
                }
            });

            const gold = prices["PAXGUSDT"] || 2700;

            // Actualizaciones directas
            const update = (cls, val, dec = 2) => {
                const elements = document.getElementsByClassName(cls);
                const text = `$${val.toLocaleString(undefined, {minimumFractionDigits: dec, maximumFractionDigits: dec})}`;
                for (let el of elements) {
                    el.textContent = text; // textContent es mÃ¡s seguro que innerHTML
                }
            };

            update('tick-btc', prices["BTCUSDT"]);
            update('tick-eth', prices["ETHUSDT"]);
            update('tick-sol', prices["SOLUSDT"]);
            update('tick-pepe', prices["PEPEUSDT"], 8);
            update('tick-floki', prices["FLOKIUSDT"], 6);
            update('tick-gold', gold);
            update('tick-silver', gold / 84.5);

        } catch (err) {
            console.warn("Fallo de red o CSP detectado. Usando cachÃ©.");
        }
    }

    // --- TICKER INFINITO (ARREGLADO) ---
    function setupInfiniteTicker() {
        const tickerMove = document.querySelector('.ticker-move');
        const items = tickerMove.innerHTML;
        // Triplicamos el contenido para el loop perfecto de 33%
        tickerMove.innerHTML = items + items + items;
    }

    // --- ARREGLO DE FUNCIONES DE FUTUROS PROYECTOS ---
    function moveFuture(index, direction) {
        const target = index + direction;
        if (target >= 0 && target < futureProjects.length) {
            const temp = futureProjects[index];
            futureProjects[index] = futureProjects[target];
            futureProjects[target] = temp;
            save();
            renderFutureList();
        }
    }

    function deleteFuture(index) {
        if(confirm('Â¿Eliminar proyecto futuro?')) {
            futureProjects.splice(index, 1);
            save();
            renderFutureList();
        }
    }

    // --- RESTO DE LA LOGICA (PDF, GRÃFICAS, ETC) ---
    async function exportToPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        const date = new Date().toLocaleString();

        // --- FONDO Y CABECERA ---
        doc.setFillColor(10, 10, 10); 
        doc.rect(0, 0, 210, 297, 'F');

        doc.setTextColor(0, 255, 163);
        doc.setFontSize(22);
        doc.setFont("helvetica", "bold");
        doc.text("INVERTRACK PRO", 20, 25);
        
        doc.setTextColor(100, 100, 100);
        doc.setFontSize(9);
        doc.text(`TERMINAL REPORT | ${date}`, 20, 32);
        doc.setDrawColor(40, 40, 40);
        doc.line(20, 35, 190, 35);

        // --- TABLA DE ACTIVOS ---
        let yPos = 50;
        let totalPortfolio = 0, totalInitial = 0;
        
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(10);
        doc.text("Activo", 20, yPos);
        doc.text("Valor (USD)", 85, yPos);
        doc.text("Net Profit", 130, yPos);
        doc.text("Perf.", 175, yPos);
        yPos += 5;
        doc.line(20, yPos, 190, yPos);
        yPos += 10;

        for (let name in projects) {
            const p = projects[name];
            if (p.data.length > 0) {
                const currentVal = p.data[p.data.length - 1].price;
                const initialVal = p.data[0].price;
                const profit = currentVal - initialVal;
                const performance = initialVal !== 0 ? (profit / initialVal) * 100 : 0;
                totalPortfolio += currentVal;
                totalInitial += initialVal;

                doc.setTextColor(200, 200, 200);
                doc.setFontSize(9);
                doc.text(name, 20, yPos);
                doc.setTextColor(255, 255, 255);
                doc.text(`$${currentVal.toLocaleString()}`, 85, yPos);
                
                if (profit >= 0) doc.setTextColor(0, 255, 163); else doc.setTextColor(255, 77, 77);
                doc.text(`$${profit.toLocaleString()}`, 130, yPos);
                doc.text(`${performance.toFixed(1)}%`, 175, yPos);
                
                yPos += 8;
                if (yPos > 270) { 
                    doc.addPage(); 
                    doc.setFillColor(10,10,10); 
                    doc.rect(0,0,210,297,'F'); 
                    yPos = 30; 
                }
            }
        }

        // --- RESUMEN DE CARTERA ---
        yPos += 10;
        doc.setDrawColor(0, 255, 163);
        doc.line(20, yPos, 190, yPos);
        yPos += 12;

        const globalProfit = totalPortfolio - totalInitial;
        const globalRoi = totalInitial !== 0 ? (globalProfit / totalInitial) * 100 : 0;
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(11);
        doc.text("TOTAL CARTERA:", 20, yPos);
        doc.text(`$${totalPortfolio.toLocaleString()}`, 60, yPos);
        if (globalProfit >= 0) doc.setTextColor(0, 255, 163); else doc.setTextColor(255, 77, 77);
        doc.text(`Profit: $${globalProfit.toLocaleString()}`, 110, yPos);
        doc.text(`ROI: ${globalRoi.toFixed(2)}%`, 160, yPos);

        // --- SECCIÃ“N DE GRÃFICA (ALTA DENSIDAD) ---
        yPos += 20;
        if (yPos > 210) { 
            doc.addPage(); 
            doc.setFillColor(10,10,10); 
            doc.rect(0,0,210,297,'F'); 
            yPos = 30; 
        }

        doc.setTextColor(0, 255, 163);
        doc.setFontSize(13);
        doc.text(current ? `EVOLUCIÃ“N: ${current.toUpperCase()}` : "EVOLUCIÃ“N GLOBAL DE CARTERA", 20, yPos);
        yPos += 10;

        const mainChartId = current ? 'detailChart' : 'globalChart';
        const chartInstance = current ? detChart : gChart;

        if (chartInstance) {
            // --- SECUENCIA DE CAPTURA HD ---
            // 1. Aumentamos la resoluciÃ³n interna del grÃ¡fico
            chartInstance.options.devicePixelRatio = 4; // Super resoluciÃ³n
            chartInstance.resize(); // Forzar redibujado
            chartInstance.update('none'); // Sin animaciones

            const canvasHD = document.getElementById(mainChartId);
            const ratio = canvasHD.height / canvasHD.width;
            const targetWidth = 175;
            const targetHeight = targetWidth * ratio;
            
            // 2. Extraemos la imagen con compresiÃ³n mÃ­nima
            const imgData = canvasHD.toDataURL("image/png", 1.0);
            
            // 3. Insertamos en el PDF
            doc.addImage(imgData, 'PNG', 18, yPos, targetWidth, targetHeight, undefined, 'SLOW');

            // 4. Restauramos el grÃ¡fico para que se vea bien en web otra vez
            chartInstance.options.devicePixelRatio = window.devicePixelRatio || 1;
            chartInstance.resize();
            chartInstance.update();
        }

        doc.save(`Reporte-InverTrack-Pro-HD.pdf`);
    }
    function save() { 
        localStorage.setItem('invertrack_v15', JSON.stringify(projects)); 
        localStorage.setItem('invertrack_futures_v2', JSON.stringify(futureProjects));
    }

    function hideAll() {
        document.getElementById('global-view').style.display = 'none';
        document.getElementById('detail-view').style.display = 'none';
        document.getElementById('future-view').style.display = 'none';
        document.getElementById('compound-view').style.display = 'none';
        document.getElementById('btnGlobal').classList.remove('active');
        document.getElementById('btnFuture').classList.remove('active');
        document.getElementById('btnCompound').classList.remove('active');
        current = null;
    }

    function showGlobal() {
        hideAll();
        document.getElementById('global-view').style.display = 'block';
        document.getElementById('btnGlobal').classList.add('active');
        renderLists();
        const catTotals = {};
        const allDates = new Set();
        for (let n in projects) { projects[n].data.forEach(d => allDates.add(d.month)); }
        const sortedDates = Array.from(allDates).sort((a, b) => new Date(a) - new Date(b));
        const timelineArr = sortedDates.map(date => {
            let dailySum = 0;
            for (let n in projects) {
                const data = projects[n].data;
                const priceAtDate = data.reduce((acc, curr) => {
                    if (new Date(curr.month) <= new Date(date)) return curr.price;
                    return acc;
                }, 0);
                dailySum += priceAtDate;
            }
            return { month: date, price: dailySum };
        });

        const filteredTimeline = filterDataByRange(timelineArr);
        const totalEnRango = filteredTimeline.length > 0 ? filteredTimeline[filteredTimeline.length - 1].price : 0;
        const inicialEnRango = filteredTimeline.length > 0 ? filteredTimeline[0].price : 0;
        let globalDiff = totalEnRango - inicialEnRango;
        let globalRoi = inicialEnRango !== 0 ? (globalDiff / inicialEnRango) * 100 : 0;

        document.getElementById('g-total').innerText = `$${totalEnRango.toLocaleString()}`;
        document.getElementById('g-profit').innerText = `${globalDiff >= 0 ? '+' : ''}$${globalDiff.toLocaleString()}`;
        document.getElementById('g-roi').innerText = `${globalRoi.toFixed(2)}%`;
        document.getElementById('g-roi').style.color = globalDiff >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';

        document.getElementById('globalBody').innerHTML = Object.keys(projects).map(n => {
            const p = projects[n];
            if (p.data.length === 0) return '';
            
            // --- LÃ³gica de Color por CategorÃ­a ---
            const catColor = colors[p.cat] || '#ffffff'; 
            
            const p_filtered = filterDataByRange(p.data);
            const valFin = p_filtered[p_filtered.length - 1].price;
            const valIni = p_filtered[0].price;
            const diff = valFin - valIni;
            const perf = valIni !== 0 ? (diff / valIni) * 100 : 0;
            const weight = totalEnRango > 0 ? (valFin / totalEnRango) * 100 : 0;
            catTotals[p.cat] = (catTotals[p.cat] || 0) + valFin;

            return `
                <tr>
                    <td><span class="tag" style="border-color:${catColor}; color:${catColor}">${p.cat}</span></td>
                    <td style="font-weight:600; color:${catColor}">${n}</td>
                    <td class="val-reveal">$${valFin.toLocaleString()}</td>
                    <td class="val-reveal" style="color:${diff >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                        ${diff >= 0 ? '+' : ''}$${diff.toLocaleString()}
                    </td>
                    <td style="color:${diff >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}; font-weight:600">
                        ${perf.toFixed(1)}%
                    </td>
                    <td style="color:var(--text-dim)">${weight.toFixed(1)}%</td>
                </tr>`;
        }).join('');

        setTimeout(() => {
            updateChart('globalChart', filteredTimeline.map(d=>d.month), filteredTimeline.map(d=>d.price), (globalDiff < 0 ? '#ff4d4d' : '#00ffa3'), true);
            updateDonut(Object.keys(catTotals), Object.values(catTotals));
            if(isPrivate) applyPrivacyUI();
        }, 10);
    }

   function showProject(name) {
        hideAll();
        current = name;
        document.getElementById('detail-view').style.display = 'block';

        // --- LIMPIEZA DE ENTRADAS PARA DATOS TIPO PARCIAL ---
        // Reseteamos el precio y ponemos la fecha de hoy por defecto
        const priceInput = document.getElementById('pPrice');
        const dateInput = document.getElementById('pMonth');
        
        if (priceInput) priceInput.value = ''; 
        if (dateInput) dateInput.valueAsDate = new Date(); 
        // ---------------------------------------------------

        const p = projects[name];
        document.getElementById('pTitle').innerText = name;
        
        const linkContainer = document.getElementById('pLinkIcon');
        linkContainer.innerHTML = p.link ? `<a href="${p.link}" target="_blank" class="btn-link-external"><i data-lucide="external-link" size="20"></i></a>` : '';
        
        // Si Lucide te sigue dando error de 'eval', puedes comentar la siguiente lÃ­nea:
        if (window.lucide) lucide.createIcons();

        const filtered = filterDataByRange(p.data);
        let p_val = 0, p_start = 0, p_diff = 0, p_roi = 0;

        if (filtered.length > 0) {
            p_val = filtered[filtered.length - 1].price;
            p_start = filtered[0].price;
            p_diff = p_val - p_start;
            p_roi = p_start !== 0 ? (p_diff / p_start) * 100 : 0;
        }

        document.getElementById('p-total').innerText = `$${p_val.toLocaleString()}`;
        document.getElementById('p-profit').innerText = `${p_diff >= 0 ? '+' : ''}$${p_diff.toLocaleString()}`;
        document.getElementById('p-roi').innerText = `${p_roi.toFixed(2)}%`;
        document.getElementById('p-roi').style.color = p_diff >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';

        setTimeout(() => { 
            updateChart('detailChart', filtered.map(d=>d.month), filtered.map(d=>d.price), (p_diff < 0 ? '#ff4d4d' : '#00ffa3'), false); 
            if(isPrivate) applyPrivacyUI(); 
        }, 10);

        renderLists();
    }

    function showFutureProjects() {
        hideAll();
        document.getElementById('future-view').style.display = 'block';
        document.getElementById('btnFuture').classList.add('active');
        renderFutureList();
    }

    function showCompound() {
        hideAll();
        document.getElementById('compound-view').style.display = 'block';
        document.getElementById('btnCompound').classList.add('active');
        if (compChart) compChart.destroy();
    }

    function calculateCompound() {
        const P = parseFloat(document.getElementById('cInitial').value) || 0;
        const PMT = parseFloat(document.getElementById('cMonthly').value) || 0;
        const r = (parseFloat(document.getElementById('cRate').value) || 0) / 100 / 12;
        const t = (parseFloat(document.getElementById('cYears').value) || 0) * 12;
        let total = P, totalInvested = P, dataPoints = [P], labels = ['Inicio'];
        for (let i = 1; i <= t; i++) {
            total = (total + PMT) * (1 + r);
            totalInvested += PMT;
            if (i % 12 === 0) { dataPoints.push(total.toFixed(2)); labels.push(`AÃ±o ${i/12}`); }
        }
        document.getElementById('c-final').innerText = `$${Math.round(total).toLocaleString()}`;
        document.getElementById('c-invested').innerText = `$${Math.round(totalInvested).toLocaleString()}`;
        document.getElementById('c-interest').innerText = `$${Math.round(total - totalInvested).toLocaleString()}`;
        const ctx = document.getElementById('compoundChart').getContext('2d');
        if (compChart) compChart.destroy();
        compChart = new Chart(ctx, {
            type: 'bar',
            data: { labels, datasets: [{ label: 'Capital', data: dataPoints, backgroundColor: 'rgba(0, 255, 163, 0.2)', borderColor: '#00ffa3', borderWidth: 2 }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { grid: { color: 'rgba(255,255,255,0.05)' } }, x: { grid: { display: false } } }, plugins: { legend: { display: false } } }
        });
    }

    function addFuture() {
        const name = document.getElementById('futureInput').value.trim(), priority = document.getElementById('futurePriority').value;
        if(name) { futureProjects.push({ name, priority }); document.getElementById('futureInput').value = ''; save(); renderFutureList(); }
    }

    function renderFutureList() {
        document.getElementById('futureList').innerHTML = futureProjects.map((p, i) => `<div class="future-item"><div class="future-main-info"><div class="priority-dot" style="background:${priorityColors[p.priority]}"></div><div style="display:flex; flex-direction:column;"><span style="font-weight:700; font-size:0.9rem;">${p.name}</span><span class="priority-label" style="color:${priorityColors[p.priority]}; padding-left:0;">${p.priority}</span></div></div><div class="future-actions"><button class="btn-move" onclick="moveFuture(${i}, -1)"><i data-lucide="chevron-up" size="14"></i></button><button class="btn-move" onclick="moveFuture(${i}, 1)"><i data-lucide="chevron-down" size="14"></i></button><button class="btn-move" style="color:var(--accent-red)" onclick="deleteFuture(${i})"><i data-lucide="trash-2" size="14"></i></button></div></div>`).join('');
        lucide.createIcons();
    }

    function addProject() {
        const name = document.getElementById('pName').value.trim(), cat = document.getElementById('pCat').value, link = document.getElementById('pLink').value.trim();
        if (name && !projects[name]) { projects[name] = { cat, link, data: [] }; document.getElementById('pName').value = ''; document.getElementById('pLink').value = ''; save(); showProject(name); }
    }

    function renderLists() {
        const list = document.getElementById('listActive'); list.innerHTML = '';
        for (let n in projects) {
            const div = document.createElement('div'); div.className = `nav-item ${current === n ? 'active' : ''}`;
            div.innerHTML = `<div style="width:6px; height:6px; border-radius:50%; background:${colors[projects[n].cat] || '#fff'}"></div> <span>${n}</span>`;
            div.onclick = () => showProject(n);
            list.appendChild(div);
        }
    }

    function setRange(range, btn) {
        currentRange = range;
        document.querySelectorAll(`.filter-btn[data-range]`).forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if (current) showProject(current); else showGlobal();
    }

    function filterDataByRange(data) {
        if (!data || data.length === 0) return [];
        if (currentRange === 'ALL') return data;
        
        const now = new Date(); 
        let cutoff = new Date();

        if (currentRange === '1D') {
            cutoff.setDate(now.getDate() - 1);
        } 
        else if (currentRange === '1W') {
            cutoff.setDate(now.getDate() - 7); 
        } 
        else if (!isNaN(currentRange)) {
            cutoff.setMonth(now.getMonth() - parseInt(currentRange));
        }

        const filtered = data.filter(d => new Date(d.month) >= cutoff);
        return filtered.length > 0 ? filtered : [data[data.length - 1]];
    }

    function toggleSMA() {
        showSMA = !showSMA;
        
        const btnG = document.getElementById('btnSMA_global');
        const btnD = document.getElementById('btnSMA_detail');
        
        if(btnG) btnG.style.color = showSMA ? 'var(--accent-green)' : '#555';
        if(btnD) btnD.style.color = showSMA ? 'var(--accent-green)' : '#555';

        if (current) {
            const p = projects[current];
            const filtered = filterDataByRange(p.data);
            const p_val = filtered.length > 0 ? filtered[filtered.length - 1].price : 0;
            const p_start = filtered.length > 0 ? filtered[0].price : 0;
            const p_diff = p_val - p_start;
            updateChart('detailChart', filtered.map(d=>d.month), filtered.map(d=>d.price), (p_diff < 0 ? '#ff4d4d' : '#00ffa3'), false);
        } else {
            showGlobal();
        }
        
        if(window.lucide) lucide.createIcons();
    }

    function updateChart(id, labels, data, color, isGlobal = false) {
        const canvas = document.getElementById(id); 
        if(!canvas) return;
        const ctx = canvas.getContext('2d');
        
        if(isGlobal) { if(gChart) gChart.destroy(); } else { if(detChart) detChart.destroy(); }
        
        const average = data.length > 0 ? data.reduce((a, b) => a + b, 0) / data.length : 0;
        const avgLine = data.map(() => average); 

        const grad = ctx.createLinearGradient(0,0,0,400); 
        grad.addColorStop(0, color + '33'); 
        grad.addColorStop(1, 'transparent');

        const datasets = [{ 
            label: 'Precio',
            data, 
            borderColor: color, 
            borderWidth: 3, 
            tension: 0.4, 
            fill: true, 
            backgroundColor: grad, 
            pointRadius: data.length < 15 ? 4 : 0, 
            pointHoverRadius: 8,
            pointBackgroundColor: color, 
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointHoverBorderWidth: 3,
            zIndex: 2
        }];

        if(typeof showSMA !== 'undefined' && showSMA) {
            datasets.push({
                label: 'Promedio del Periodo',
                data: avgLine,
                borderColor: 'rgba(255, 255, 255, 0.4)',
                borderWidth: 1.5,
                borderDash: [10, 5],
                pointRadius: 0,
                fill: false,
                zIndex: 1
            });
        }

        const config = { 
            type: 'line', 
            data: { labels, datasets }, 
            options: { 
                responsive: true, 
                maintainAspectRatio: false, 
                interaction: { intersect: false, mode: 'index' },
                plugins: { 
                    legend: { display: false }, 
                    tooltip: { 
                        enabled: true, 
                        backgroundColor: '#111', 
                        titleFont: { family: 'Plus Jakarta Sans', size: 12 },
                        bodyFont: { family: 'JetBrains Mono', size: 13 },
                        padding: 12, 
                        displayColors: true,
                        callbacks: { 
                            label: (ctx) => ` ${ctx.dataset.label}: $${ctx.parsed.y.toLocaleString()}` 
                        } 
                    } 
                }, 
                scales: { 
                    y: { 
                        display: true, 
                        position: 'right', 
                        grid: { color: 'rgba(255,255,255,0.03)' }, 
                        ticks: { color: '#444', font: { size: 10, family: 'JetBrains Mono' }, callback: (v) => '$' + v.toLocaleString() } 
                    }, 
                    x: { grid: { display: false }, ticks: { color: '#444', font: { size: 10 }, autoSkip: true, maxTicksLimit: 10 } } 
                } 
            } 
        };
        
        if(isGlobal) gChart = new Chart(ctx, config); else detChart = new Chart(ctx, config);
    }

    function updateDonut(labels, data) {
        const canvas = document.getElementById('donutChart');
        if(!canvas) return;
        if(dChart) dChart.destroy();
        
        const backgroundColors = labels.map(label => colors[label] || '#333333');
        const totalValue = data.reduce((a, b) => a + b, 0);

        dChart = new Chart(canvas, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: backgroundColors,
                    borderColor: '#0a0a0a',
                    borderWidth: 4,
                    // 1. Reducimos o eliminamos el hoverOffset para que no crezca hacia afuera
                    hoverOffset: 4 
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                // 2. AÃ±adimos padding para que, si crece, tenga espacio y no se corte
                layout: {
                    padding: 15
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        enabled: true,
                        backgroundColor: '#111',
                        titleFont: { family: 'Plus Jakarta Sans', size: 14, weight: 'bold' },
                        bodyFont: { family: 'JetBrains Mono', size: 13 },
                        padding: 12,
                        displayColors: true,
                        borderColor: 'rgba(255,255,255,0.1)',
                        borderWidth: 1,
                        callbacks: {
                            label: function(tooltipItem) {
                                const value = tooltipItem.raw;
                                const percentage = totalValue > 0 ? ((value / totalValue) * 100).toFixed(1) : 0;
                                return ` Invertido: $${value.toLocaleString()} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });
    }
    function addPrice() {
        const monthEl = document.getElementById('pMonth');
        const priceEl = document.getElementById('pPrice');
        const v = parseFloat(priceEl.value);
        const m = monthEl.value;

        if(m && !isNaN(v) && current) { 
            projects[current].data.push({month: m, price: v}); 
            projects[current].data.sort((a,b) => new Date(a.month) - new Date(b.month)); 
            save(); 
            
            // --- LIMPIEZA INMEDIATA ---
            priceEl.value = ''; 
            // monthEl.value = ''; // Opcional: limpiar tambiÃ©n la fecha
            
            showProject(current); 
        }
    }

    function togglePrivacy() { isPrivate = !isPrivate; applyPrivacyUI(); }
    function applyPrivacyUI() { document.querySelectorAll('.val-reveal').forEach(el => isPrivate ? el.classList.add('hidden-val') : el.classList.remove('hidden-val')); }
    function deleteProject() { if(confirm('Delete?')) { delete projects[current]; save(); showGlobal(); } }
    function exportData() { const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify({projects, futureProjects})); const a = document.createElement('a'); a.setAttribute("href", dataStr); a.setAttribute("download", "invertrack_backup.json"); a.click(); }
    function importData(event) { const file = event.target.files[0]; const reader = new FileReader(); reader.onload = (e) => { try { const imported = JSON.parse(e.target.result); projects = imported.projects || imported; futureProjects = imported.futureProjects || []; save(); showGlobal(); } catch (err) { alert('Error'); } }; reader.readAsText(file); }

    // InicializaciÃ³n
    document.addEventListener('DOMContentLoaded', () => {
        setupInfiniteTicker(); // Duplica elementos para el loop
        fetchMarketPrices();
        setInterval(fetchMarketPrices, 15000); 
        lucide.createIcons();
        setTimeout(showGlobal, 100);
    });

</script>
</body>
</html>
